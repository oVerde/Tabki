"use strict";(()=>{var n=class{static endpoint="http://localhost:8765";static async request(e,t){let a={action:e,version:6,params:t??{}};try{let s=await(await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();return s.error?(console.error(`Anki error: ${s.error}`),null):s.result??null}catch(o){return console.error(`Network or other error: ${o}`),null}}static getDeckNames(){return this.request("deckNames")}static async setReviewMode(e){return this.request("guiDeckReview",{name:e})}static async getModelStyling(e){let t=await this.request("modelStyling",{modelName:e});return t?t.css:null}static async getCurrentCard(){return await this.request("guiCurrentCard")}static async getCardInfo(e){let t=await this.request("cardsInfo",{cards:[e]});return t?t[0]:null}static async answerCard(e){return this.request("guiAnswerCard",{ease:e})}};async function u(){let r=document.getElementById("question"),e=document.getElementById("answer"),t=document.getElementById("show-answer"),a=document.getElementById("again"),o=document.getElementById("good"),s=document.getElementById("easy");r.textContent="Loading card...",e.style.display="none",a.style.display="none",o.style.display="none",s.style.display="none",t.style.display="inline-block";let{deckName:m}=await browser.storage.local.get("deckName");if(!m){r.textContent="Please select a deck in Tabki Options.";return}await n.setReviewMode(m);let c=await n.getCurrentCard();if(!c){r.textContent="No cards available or could not connect to Anki.";return}let i=await n.getCardInfo(c.cardId);if(i&&i.modelName){console.log("cardInfo",i),console.log("cardInfo.modelName",i.modelName);let l=await n.getModelStyling(i.modelName);if(l){let d=document.createElement("style");d.textContent=l,document.head.appendChild(d)}}r.innerHTML=c.question,e.innerHTML=c.answer,r.querySelectorAll("script").forEach(l=>{let d=l.textContent||"",y=document.createElement("script");y.textContent=d,document.head.appendChild(y),l.remove()}),t.onclick=()=>{e.style.display="block",t.style.display="none",a.style.display="inline-block",o.style.display="inline-block",s.style.display="inline-block"},a.onclick=async()=>{await n.answerCard(1),u()},o.onclick=async()=>{await n.answerCard(3),u()},s.onclick=async()=>{await n.answerCard(4),u()}}document.addEventListener("DOMContentLoaded",()=>{requestAnimationFrame(()=>{u()})});})();
